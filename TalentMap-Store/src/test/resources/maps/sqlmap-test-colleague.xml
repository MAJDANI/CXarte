<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="colleague">

    <typeAlias alias="colleague" type="com.novedia.talentmap.model.entity.Colleague"/> 

    <resultMap id="colleagueResult"          class="colleague">
        <result property="id"                column="COLLEAGUE_ID"/>     
        <result property="managerId"         column="MANAGER_ID"/>         
        <result property="profileId"         column="PROFILE_ID"/>    	    
        <result property="lastName"          column="LAST_NAME"/>	   
        <result property="firstName"         column="FIRST_NAME"/>	   
        <result property="email"             column="EMAIL"/>	    
        <result property="phone"             column="PHONE"/>
        <result property="employmentDate"    column="EMPLOYMENT_DATE"/>	    
        <result property="experience"        column="EXPERIENCE"/>
        <result property="businessEngineer"  column="BUSINESS_ENGINEER"/>	   
    </resultMap>

    <select id="get" parameterClass="Integer" resultMap="colleagueResult">
        SELECT * FROM  COLLEAGUE WHERE COLLEAGUE_ID = #id#
    </select>
    
    <select id="getAll" resultMap="colleagueResult">
    	SELECT * FROM COLLEAGUE
    </select>
    					 
	<update id="save" parameterClass="Colleague">
		UPDATE COLLEAGUE SET LAST_NAME = #lastName#, FIRST_NAME = #firstName#, EMAIL = #email#, EMPLOYMENT_DATE = #employmentDate#, PROFILE_ID = #profileId#, PHONE = #phone#, EXPERIENCE = #experience#, BUSINESS_ENGINEER = #businessEngineer# WHERE COLLEAGUE_ID = #id#
	</update>
	
    <!-- v.guillemain -->
    <select id="getAllByLastName" parameterClass="String" resultMap="colleagueResult">
        SELECT * FROM  COLLEAGUE WHERE UPPER(LAST_NAME) LIKE UPPER('$lastName$%')
    </select>
   
    <select id="getAllColleaguesByClientName" parameterClass="string" resultMap="colleagueResult">
        SELECT DISTINCT c.* FROM  MISSION m, COLLEAGUE c 
        WHERE m.COLLEAGUE_ID = c.COLLEAGUE_ID
        AND UPPER(m.CLIENT) LIKE UPPER('$clientName$')
    </select>

	<select id="getAllColleaguesByListToolId" resultMap="colleagueResult" parameterClass="java.util.Hashtable">
  		SELECT c.* FROM 
		(SELECT s.COLLEAGUE_ID, COUNT(*) as nbTool FROM SKILL s, TOOL t
		WHERE s.TOOL_ID = t.TOOL_ID
		AND s.TOOL_ID IN 
		<iterate 	property = "listId"
					open="(" 
					close=")"
					conjunction=",">
   					#listId[]#
  		</iterate>
		GROUP BY s.COLLEAGUE_ID) a, COLLEAGUE c
		WHERE a.COLLEAGUE_ID = c.COLLEAGUE_ID
		AND a.nbTool = #listSize[0]#
    </select>	

	<insert id="add">
		<selectKey resultClass="Integer" keyProperty="id">
      		SELECT SEQCOLLEAGUE.NEXTVAL FROM DUAL
    	</selectKey>
 	
    	INSERT INTO COLLEAGUE (
    		COLLEAGUE_ID,
    		MANAGER_ID,
    		PROFILE_ID,
    		LAST_NAME,
    		FIRST_NAME, 
    		EMAIL,
    		PHONE,
    		EMPLOYMENT_DATE,
    		EXPERIENCE,
    		BUSINESS_ENGINEER
    		)values (
    		#id#, #managerId#, #profileId#, #lastName#, #firstName#, #email#, #phone#, #employmentDate#, #experience#, #businessEngineer#
    		)
	</insert>
</sqlMap>