<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="tool">

    <typeAlias alias="tool" type="com.novedia.talentmap.model.entity.Tool"/> 
    
    <resultMap id="toolResult"                    class="tool">
    	<result property="id"                     column="TOOL_ID"/> 
        <result property="name"                   column="TOOL_NAME"/>          
        <result property="concept.id"             column="CONCEPT_ID"/>
        <result property="concept.name"           column="CONCEPT_NAME"/> 
    </resultMap>
	
	<select id="get" resultMap="toolResult" parameterClass="Integer">
		SELECT * FROM TOOL tool, CONCEPT concept WHERE tool.TOOL_ID = #id# AND tool.CONCEPT_ID = concept.CONCEPT_ID
	</select>
	
	<select id="getByName" parameterClass="String" resultClass="tool">
		SELECT * FROM TOOL tool, CONCEPT concept WHERE tool.TOOL_NAME = #name# AND tool.CONCEPT_ID = concept.CONCEPT_ID
	</select>
	
    <statement id="getAll" resultMap="toolResult">
    	SELECT * FROM TOOL tool, CONCEPT concept WHERE tool.CONCEPT_ID = concept.CONCEPT_ID
    </statement>
    
    <select id="getAllByConcept" resultClass="tool" parameterClass="Integer">
    	SELECT * FROM TOOL WHERE CONCEPT_ID = #conceptId#
    </select>	
        
    <insert id="add" parameterClass="Tool">
    	<selectKey resultClass="Integer" keyProperty="id">
      		SELECT SEQTOOL.NEXTVAL FROM DUAL
    	</selectKey>
    	INSERT INTO TOOL (TOOL_ID, CONCEPT_ID, TOOL_NAME)
    	values (#id#, #concept.id#, upper(#name#))
    </insert>    
    
    <select id="check" resultClass="tool" parameterClass="String">
		SELECT * FROM TOOL WHERE upper(TOOL_NAME) = upper(#name#)
	</select>		
	
	<update id="save" parameterClass="Tool">
		UPDATE TOOL SET TOOL_ID = #id#, CONCEPT_ID = #concept.id#, TOOL_NAME = #name# WHERE TOOL_ID = #id#
	</update> 
	
	<delete id="delete" parameterClass="Tool">
		DELETE TOOL CASCADE	WHERE TOOL_ID = #id#
	</delete>	 

</sqlMap>