<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="skill">

	<typeAlias alias="skill" type="com.novedia.talentmap.model.entity.Skill" />
	<typeAlias alias="colleague"
		type="com.novedia.talentmap.model.entity.Colleague" />

	<resultMap id="skillResult" class="skill">
		<result property="colleagueId" column="COLLEAGUE_ID" />
		<result property="tool_id" column="TOOL_ID" />
		<result property="score" column="SCORE" />
		<result property="use_frequency" column="USE_FREQUENCY" />
		<result property="no_using_time" column="NO_USING_TIME" />
	</resultMap>

	<resultMap id="collabIdResult" class="java.lang.Integer">
		<result property="colleagueId" column="COLLEAGUE_ID" />
	</resultMap>

	<select id="getAllSkillsByCollaborator" resultMap="skillResult"
		parameterClass="colleague">
		SELECT * FROM SKILL WHERE COLLEAGUE_ID = #id#
	</select>

	<select id="get" resultMap="skillResult" parameterClass="java.util.HashMap">
		SELECT *
		FROM SKILL WHERE COLLEAGUE_ID = #collaboratorId# AND TOOL_ID =
		#toolId#
	</select>

	<select id="getAllCollaboratorSkill" resultMap="skillResult">
		SELECT * FROM SKILL WHERE COLLEAGUE_ID = #colleagueId#
	</select>

	<insert id="add" parameterClass="Skill">
		INSERT into SKILL (
		COLLEAGUE_ID,
		TOOL_ID,
		SCORE,
		USE_FREQUENCY,
		NO_USING_TIME
		)values (
		#colleagueId#, #tool_id#, #score#, #use_frequency#, #no_using_time#
		)
	</insert>

	<update id="save" parameterClass="Skill">
		UPDATE SKILL SET COLLEAGUE_ID =
		#colleagueId#, TOOL_ID = #tool_id#, SCORE = #score#, USE_FREQUENCY =
		#use_frequency#, NO_USING_TIME = #no_using_time#
		WHERE COLLEAGUE_ID = #colleagueId# AND TOOL_ID = #tool_id#
	</update>

	<!-- v.guillemain 30/07/12 -->
	<select id="getAllCollaboratorsIdByToolId" resultMap="collabIdResult"
		parameterClass="java.lang.Integer">
		SELECT COLLEAGUE_ID FROM SKILL WHERE TOOL_ID = #toolId#
	</select>

	<!-- v.guillemain 31/07/12 -->
	<select id="getAllCollaboratorIdByToolIdAndCollabList"
		resultMap="collabIdResult" parameterClass="com.novedia.talentmap.store.impl.SkillParameter">
		SELECT COLLEAGUE_ID FROM SKILL
		WHERE TOOL_ID = #toolId#
		AND COLLEAGUE_ID IN
		<iterate property="listCollaborators" open="(" close=")"
			conjunction=",">
			#listCollaborators[]#
		</iterate>
	</select>


</sqlMap>