<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="authentication">

	<typeAlias alias="authentication"
		type="com.novedia.talentmap.model.entity.Authentication" />
	<typeAlias alias="token"
		type="com.novedia.talentmap.model.entity.CredentialToken" />

	<resultMap id="authenticationResult" class="authentication">
		<result property="token.login" column="LOGIN" />
		<result property="token.password" column="PASSWORD" />
		<result property="colleagueId" column="COLLEAGUE_ID" />
		<result property="authorization.roleId" column="ROLE_ID" />
		<result property="authorization.label" column="LABEL" />
	</resultMap>

	<select id="check" resultMap="authenticationResult"
		parameterClass="com.novedia.talentmap.model.entity.CredentialToken">
		SELECT * FROM AUTHENTICATION auth, USER_ROLE role WHERE
		auth.LOGIN = #login# AND auth.PASSWORD = #password#
		AND auth.ROLE_ID =
		role.ROLE_ID
	</select>

	<select id="countLogin" resultClass="java.lang.Integer"
		parameterClass="String">
		SELECT count(*) FROM AUTHENTICATION WHERE LOGIN =
		#login#
	</select>

	<insert id="addUserFromRegistration" parameterClass="com.novedia.talentmap.model.entity.Registration">
		INSERT INTO
		AUTHENTICATION (
		LOGIN,
		PASSWORD,
		COLLEAGUE_ID,
		ROLE_ID
		)values (
		#login#,
		#password#,
		#colleagueId#,
		#role.id#
		)
	</insert>

	<update id="save" parameterClass="com.novedia.talentmap.model.entity.Authentication">
		update AUTHENTICATION set
		PASSWORD=#token.password# where LOGIN =
		#token.login#
	</update>

</sqlMap>
