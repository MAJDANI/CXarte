<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="authentication">

 <typeAlias alias="authentication" type="com.novedia.talentmap.model.entity.Authentication"/> 

	<resultMap id="authenticationResult" class="authentication">
        <result property="id" column="AUTHENTICATION_ID"/>     
        <result property="colleagueId" column="COLLEAGUE_ID"/> 
        <result property="token.login"  column="LOGIN"/>         
        <result property="token.password"  column="PASSWORD"/>
        <result property="authorization.roleId" column="ROLE_ID"/>
        <result property="authorization.label" column="LABEL"/>    
    </resultMap>
    
    <select id="check" resultMap="authenticationResult" parameterClass="com.novedia.talentmap.model.entity.CredentialToken">
		SELECT * FROM AUTHENTICATION auth, USER_ROLE role WHERE auth.LOGIN = #login# AND auth.PASSWORD = #password#
				AND auth.ROLE_ID = role.ROLE_ID
	</select>	
    
    <insert id="addUserFromRegistration" parameterClass="com.novedia.talentmap.model.entity.Registration"> 
   		<selectKey resultClass="Integer" keyProperty="authenticationId">
      		SELECT SEQAUTH.NEXTVAL FROM DUAL
    	</selectKey>
    	
    	INSERT INTO AUTHENTICATION (
    		AUTHENTICATION_ID,
    		COLLEAGUE_ID,
    		ROLE_ID,
    		LOGIN,
    		PASSWORD
    		)values (
    		#authenticationId#,
    		#colleagueId#,
    		4,
    		#login#,
    		#password#
    		)
    </insert>	
    
</sqlMap>
