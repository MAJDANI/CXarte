<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" 
	"http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="objective">

	<typeAlias alias="objective"
		type="com.novedia.talentmap.model.entity.Objective" />

	<resultMap id="objectiveResult" class="objective">
		<result property="id" column="OBJECTIVE_ID" />
		<result property="colleague.id" column="COLLEAGUE_ID" />
		<result property="manager.id" column="MANAGER_ID" />
		<result property="eae.id" column="EAE_ID" />
		<result property="title" column="TITLE" />
		<result property="goal" column="GOAL" />
		<result property="targetDate" column="TARGET_DATE" />
		<result property="indicators" column="INDICATORS" />
		<result property="means" column="MEANS" />
<!-- 		<result property="colleaguesScore.id" column="COL_OBJ_SCORE_ID" /> -->
<!-- 		<result property="managersScore.id" column="MAN_OBJ_SCORE_ID" /> -->
		<result property="colleaguesScore" column="COL_OBJ_SCORE_ID" />
		<result property="managersScore" column="MAN_OBJ_SCORE_ID" />
		<result property="motivesOrRestraints" column="MOTIVES_OR_RESTRAINTS" />
		<result property="comments" column="COMMENTS" />
	</resultMap>

	<select id="getObjective" resultMap="objectiveResult"
		parameterClass="Integer">
		SELECT * FROM OBJECTIVE WHERE OBJECTIVE_ID = #id#
	</select>

	<select id="getAll" resultMap="objectiveResult">
		SELECT DISTINCT * FROM OBJECTIVE
	</select>

	<insert id="add" parameterClass="Objective">
		INSERT INTO OBJECTIVE (
			OBJECTIVE_ID,
			COLLEAGUE_ID,
			MANAGER_ID,
			EAE_ID,
			TITLE,
			GOAL,
			TARGET_DATE,
			INDICATORS,
			MEANS,
			COL_OBJ_SCORE_ID,
			MAN_OBJ_SCORE_ID,
			MOTIVES_OR_RESTRAINTS,
			COMMENTS
		)values (
			#id#,
			#colleague.id#,
			#manager.id#,
			#eae.id#,
			#title#,
			#goal#,
			#targetDate#,
			#indicators#,
			#means#,
<!-- 			#colleaguesScore.id#, -->
<!-- 			#managersScore.id#, -->
			#colleaguesScore#,
			#managersScore#,
			#motivesOrRestraints#,
			#comments#
		)
		<selectKey keyProperty="id" resultClass="Integer">
			SELECT
			LAST_INSERT_ID() AS OBJECTIVE_ID
		</selectKey>
	</insert>

	<select id="checkObject" resultMap="objectiveResult"
		parameterClass="objective">
<!-- 		SELECT * FROM OBJECTIVE WHERE upper(OBJECTIVE_NAME) = -->
<!-- 		upper(#name#) -->
	</select>

	<update id="save" parameterClass="Objective">
		UPDATE OBJECTIVE SET
			COLLEAGUE_ID = #colleague.id# ,
			MANAGER_ID = #manager.id# ,
			EAE_ID = #eae.id# ,
			TITLE = #title# ,
			GOAL = #goal# ,
			TARGET_DATE = #targetDate# ,
			INDICATORS = #indicators# ,
			MEANS = #means# ,
<!-- 			COL_OBJ_SCORE_ID = #colleaguesScore.id# , -->
<!-- 			MAN_OBJ_SCORE_ID = #managersScore.id# , -->
			COL_OBJ_SCORE_ID = #colleaguesScore# ,
			MAN_OBJ_SCORE_ID = #managersScore# ,
			MOTIVES_OR_RESTRAINTS = #motivesOrRestraints#,
			COMMENTS = #comments#
		WHERE OBJECTIVE_ID = #id#
	</update>

	<delete id="delete" parameterClass="Objective">
		DELETE FROM OBJECTIVE WHERE
		OBJECTIVE_ID = #id#
	</delete>

	<select id="getObjectivesByEAEId" resultMap="objectiveResult"
		parameterClass="Integer">
		SELECT * FROM OBJECTIVE WHERE EAE_ID = #id#
	</select>

</sqlMap>