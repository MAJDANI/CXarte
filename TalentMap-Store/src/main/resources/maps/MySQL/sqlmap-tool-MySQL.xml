<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL MAP 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="tool">

	<typeAlias alias="tool" type="com.novedia.talentmap.model.entity.Tool" />

	<resultMap id="toolResult" class="tool">
		<result property="id" column="TOOL_ID" />
		<result property="name" column="TOOL_NAME" />
		<result property="concept.id" column="CONCEPT_ID" />
		<result property="concept.name" column="CONCEPT_NAME" />
	</resultMap>

	<select id="get" resultMap="toolResult" parameterClass="Integer">
		SELECT *
		FROM TOOL tool, CONCEPT concept WHERE tool.TOOL_ID = #id# AND
		tool.CONCEPT_ID = concept.CONCEPT_ID
	</select>

	<statement id="getByName" resultMap="toolResult"
		parameterClass="String">
		SELECT * FROM TOOL tool, CONCEPT concept WHERE
		tool.TOOL_NAME = #name# AND tool.CONCEPT_ID = concept.CONCEPT_ID
	</statement>

	<statement id="getAll" resultMap="toolResult">
		SELECT * FROM TOOL tool,
		CONCEPT concept WHERE tool.CONCEPT_ID =
		concept.CONCEPT_ID
	</statement>

	<select id="getAllByConcept" resultMap="toolResult" parameterClass="Integer">
		SELECT * FROM TOOL tool, CONCEPT concept WHERE tool.CONCEPT_ID =
		#conceptId# AND tool.CONCEPT_ID = concept.CONCEPT_ID
	</select>

	<insert id="add" parameterClass="com.novedia.talentmap.model.entity.Tool">

		INSERT INTO TOOL (
		CONCEPT_ID,
		TOOL_NAME
		)values (
		#concept.id# , #name#
		)

		<selectKey resultClass="Integer" keyProperty="id">
			SELECT
			LAST_INSERT_ID() AS TOOL_ID
		</selectKey>

	</insert>

	<select id="check" resultClass="tool" parameterClass="String">
		SELECT *
		FROM TOOL WHERE upper(TOOL_NAME) = upper(#name#)
	</select>

	<select id="checkObject" resultClass="tool" parameterClass="tool">
		SELECT * FROM TOOL WHERE upper(TOOL_NAME) = upper(#name#) AND
		CONCEPT_ID = #concept.id#
	</select>

	<update id="save" parameterClass="Tool">
		UPDATE TOOL SET TOOL_ID = #id#,
		CONCEPT_ID = #concept.id#, TOOL_NAME = #name# WHERE TOOL_ID = #id#
	</update>

	<delete id="delete" parameterClass="Tool">
		DELETE FROM TOOL WHERE
		TOOL_ID = #id#
	</delete>

</sqlMap>